<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEAM BUILDER // TFT SET 16</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --void-deep: #04060f;
    --void-dark: #080b12;
    --void-mid: #0d1020;
    --void-surface: #111827;
    --void-card: rgba(13,16,32,0.85);
    --purple-core: #7c3aed;
    --purple-bright: #8b5cf6;
    --purple-glow: #a78bfa;
    --purple-soft: rgba(139,92,246,0.15);
    --cyan-core: #0891b2;
    --cyan-bright: #06b6d4;
    --cyan-glow: #67e8f9;
    --cyan-soft: rgba(6,182,212,0.12);
    --danger: #ef4444;
    --warning: #f59e0b;
    --success: #10b981;
    --gold: #f59e0b;
    --text-primary: #e2e8f0;
    --text-secondary: #d1d5db;
    --text-dim: #9ca3af;
    --border-subtle: rgba(139,92,246,0.2);
    --border-glow: rgba(139,92,246,0.5);
    --font-display: 'Orbitron', monospace;
    --font-heading: 'Rajdhani', sans-serif;
    --font-body: 'Exo 2', sans-serif;
    --font-mono: 'Share Tech Mono', monospace;
    --cost-1: #9ca3af;
    --cost-2: #10b981;
    --cost-3: #3b82f6;
    --cost-4: #a855f7;
    --cost-5: #f59e0b;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; font-size: 16px; }

  body {
    background: var(--void-deep);
    color: var(--text-primary);
    font-family: var(--font-body);
    overflow-x: hidden;
    line-height: 1.5;
    min-height: 100vh;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.08) 2px, rgba(0,0,0,0.08) 4px);
    pointer-events: none;
    z-index: 9999;
  }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: var(--void-deep); }
  ::-webkit-scrollbar-thumb { background: var(--purple-core); border-radius: 2px; }

  #particles-canvas {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
  }

  /* ── TOP NAV ── */
  .top-nav {
    position: relative;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-subtle);
    background: rgba(4,6,15,0.9);
    backdrop-filter: blur(12px);
  }

  .back-link {
    font-family: var(--font-display);
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    color: var(--cyan-glow);
    text-decoration: none;
    transition: color 0.2s;
  }

  .back-link:hover { color: #fff; }

  .page-title {
    font-family: var(--font-display);
    font-size: clamp(1rem, 3vw, 1.5rem);
    font-weight: 900;
    letter-spacing: 0.08em;
    background: linear-gradient(135deg, #67e8f9 0%, #06b6d4 40%, #8b5cf6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    position: relative;
  }

  .page-title::before,
  .page-title::after {
    content: 'TEAM BUILDER';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #67e8f9 0%, #06b6d4 40%, #8b5cf6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .page-title::before {
    animation: glitch1 4s infinite;
    clip-path: polygon(0 0, 100% 0, 100% 35%, 0 35%);
  }

  .page-title::after {
    animation: glitch2 4s infinite;
    clip-path: polygon(0 65%, 100% 65%, 100% 100%, 0 100%);
  }

  @keyframes glitch1 {
    0%,94%,100% { transform: translate(0,0); opacity: 0; }
    95%         { transform: translate(-3px, 1px); opacity: 1; filter: hue-rotate(60deg); }
    97%         { transform: translate(3px, -1px); opacity: 1; filter: hue-rotate(-30deg); }
  }

  @keyframes glitch2 {
    0%,94%,100% { transform: translate(0,0); opacity: 0; }
    95%         { transform: translate(3px, -1px); opacity: 1; filter: hue-rotate(-60deg); }
    97%         { transform: translate(-3px, 1px); opacity: 1; filter: hue-rotate(30deg); }
  }

  .nav-spacer { width: 100px; }

  /* ── MAIN LAYOUT ── */
  .builder-wrap {
    position: relative;
    z-index: 10;
    display: grid;
    grid-template-columns: 280px 1fr 280px;
    gap: 0;
    min-height: calc(100vh - 56px);
  }

  /* ── PANELS ── */
  .panel {
    background: rgba(4,6,15,0.85);
    backdrop-filter: blur(12px);
    border-right: 1px solid var(--border-subtle);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .panel:last-child {
    border-right: none;
    border-left: 1px solid var(--border-subtle);
  }

  .panel-header {
    padding: 0.8rem 1rem;
    border-bottom: 1px solid var(--border-subtle);
    flex-shrink: 0;
  }

  .panel-title {
    font-family: var(--font-display);
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    color: var(--text-dim);
    text-transform: uppercase;
  }

  .panel-body {
    flex: 1;
    overflow-y: auto;
    padding: 0.8rem;
  }

  /* ── SEARCH / FILTERS ── */
  .search-bar {
    width: 100%;
    background: var(--void-mid);
    border: 1px solid var(--border-subtle);
    border-radius: 6px;
    padding: 0.5rem 0.7rem;
    font-family: var(--font-body);
    font-size: 0.8rem;
    color: var(--text-primary);
    outline: none;
    transition: border-color 0.2s;
    margin-bottom: 0.6rem;
  }

  .search-bar::placeholder { color: var(--text-dim); }
  .search-bar:focus { border-color: var(--cyan-core); }

  .filter-row {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
    margin-bottom: 0.6rem;
  }

  .filter-pill {
    font-family: var(--font-mono);
    font-size: 0.6rem;
    letter-spacing: 0.05em;
    padding: 0.2rem 0.45rem;
    border-radius: 3px;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.03);
    color: var(--text-dim);
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
  }

  .filter-pill:hover {
    border-color: var(--cyan-core);
    color: var(--cyan-glow);
  }

  .filter-pill.active {
    border-color: var(--cyan-core);
    background: rgba(6,182,212,0.15);
    color: var(--cyan-glow);
  }

  .cost-filters {
    display: flex;
    gap: 0.3rem;
    margin-bottom: 0.6rem;
  }

  .cost-pill {
    flex: 1;
    text-align: center;
    font-family: var(--font-display);
    font-size: 0.65rem;
    font-weight: 700;
    padding: 0.25rem 0;
    border-radius: 4px;
    border: 1px solid;
    cursor: pointer;
    transition: all 0.15s;
  }

  .cost-pill[data-cost="1"] { color: var(--cost-1); border-color: rgba(156,163,175,0.3); }
  .cost-pill[data-cost="2"] { color: var(--cost-2); border-color: rgba(16,185,129,0.3); }
  .cost-pill[data-cost="3"] { color: var(--cost-3); border-color: rgba(59,130,246,0.3); }
  .cost-pill[data-cost="4"] { color: var(--cost-4); border-color: rgba(168,85,247,0.3); }
  .cost-pill[data-cost="5"] { color: var(--cost-5); border-color: rgba(245,158,11,0.3); }

  .cost-pill.active {
    background: rgba(255,255,255,0.08);
  }

  .cost-pill[data-cost="1"].active { background: rgba(156,163,175,0.15); }
  .cost-pill[data-cost="2"].active { background: rgba(16,185,129,0.15); }
  .cost-pill[data-cost="3"].active { background: rgba(59,130,246,0.15); }
  .cost-pill[data-cost="4"].active { background: rgba(168,85,247,0.15); }
  .cost-pill[data-cost="5"].active { background: rgba(245,158,11,0.15); }

  /* ── CHAMPION GRID ── */
  .champ-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(52px, 1fr));
    gap: 4px;
  }

  .champ-card {
    position: relative;
    width: 52px;
    height: 52px;
    border-radius: 6px;
    overflow: hidden;
    cursor: grab;
    border: 2px solid;
    transition: transform 0.15s, opacity 0.2s, filter 0.2s;
    background: var(--void-mid);
  }

  .champ-card:active { cursor: grabbing; }

  .champ-card[data-cost="1"] { border-color: rgba(156,163,175,0.5); }
  .champ-card[data-cost="2"] { border-color: rgba(16,185,129,0.5); }
  .champ-card[data-cost="3"] { border-color: rgba(59,130,246,0.5); }
  .champ-card[data-cost="4"] { border-color: rgba(168,85,247,0.5); }
  .champ-card[data-cost="5"] { border-color: rgba(245,158,11,0.5); }

  .champ-card:hover {
    transform: scale(1.1);
    z-index: 2;
  }

  .champ-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none;
  }

  .champ-card .champ-name-tip {
    position: absolute;
    bottom: -24px;
    left: 50%;
    transform: translateX(-50%);
    font-family: var(--font-mono);
    font-size: 0.55rem;
    color: var(--text-primary);
    background: rgba(0,0,0,0.85);
    padding: 2px 6px;
    border-radius: 3px;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 10;
  }

  .champ-card:hover .champ-name-tip { opacity: 1; }

  .champ-card.on-board {
    opacity: 0.35;
    filter: grayscale(0.6);
    pointer-events: none;
  }

  .champ-card.on-board::after {
    content: '\2713';
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: var(--success);
    background: rgba(0,0,0,0.4);
  }

  .champ-card.dragging {
    opacity: 0.4;
    transform: scale(0.9);
  }

  /* ── CENTER BOARD ── */
  .board-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: transparent;
    border-right: 1px solid var(--border-subtle);
    border-left: 1px solid var(--border-subtle);
    position: relative;
    padding: 1rem;
  }

  .board-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
  }

  .board-row {
    display: flex;
    gap: 4px;
  }

  .board-row.offset {
    margin-left: 40px;
  }

  /* ── HEX CELL ── */
  .hex-cell {
    width: 72px;
    height: 72px;
    position: relative;
    clip-path: polygon(50% 0%, 93% 25%, 93% 75%, 50% 100%, 7% 75%, 7% 25%);
    background: var(--void-mid);
    cursor: pointer;
    transition: background 0.2s, filter 0.15s;
    flex-shrink: 0;
  }

  .hex-cell-inner {
    position: absolute;
    inset: 2px;
    clip-path: polygon(50% 0%, 93% 25%, 93% 75%, 50% 100%, 7% 75%, 7% 25%);
    background: var(--void-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }

  .hex-cell.empty .hex-plus {
    font-family: var(--font-display);
    font-size: 1.2rem;
    color: rgba(255,255,255,0.1);
    transition: color 0.2s;
  }

  .hex-cell.empty:hover .hex-cell-inner {
    background: rgba(6,182,212,0.08);
  }

  .hex-cell.empty:hover .hex-plus {
    color: rgba(6,182,212,0.4);
  }

  .hex-cell.drag-over {
    filter: brightness(1.4);
  }

  .hex-cell.drag-over .hex-cell-inner {
    background: rgba(6,182,212,0.15);
  }

  .hex-cell.filled .hex-cell-inner {
    padding: 0;
  }

  .hex-cell.filled .hex-portrait {
    width: 100%;
    height: 100%;
    object-fit: cover;
    pointer-events: none;
  }

  .hex-cell.filled .hex-remove {
    position: absolute;
    top: 2px;
    right: 8px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: rgba(239,68,68,0.8);
    color: #fff;
    font-size: 0.55rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 5;
    border: none;
    font-family: var(--font-body);
    line-height: 1;
  }

  .hex-cell.filled:hover .hex-remove { opacity: 1; }

  .hex-name-tag {
    position: absolute;
    bottom: -18px;
    left: 50%;
    transform: translateX(-50%);
    font-family: var(--font-mono);
    font-size: 0.5rem;
    color: var(--text-secondary);
    white-space: nowrap;
    pointer-events: none;
    text-shadow: 0 1px 4px rgba(0,0,0,0.8);
  }

  .hex-cell.filled[data-cost="1"] { background: rgba(156,163,175,0.4); }
  .hex-cell.filled[data-cost="2"] { background: rgba(16,185,129,0.4); }
  .hex-cell.filled[data-cost="3"] { background: rgba(59,130,246,0.4); }
  .hex-cell.filled[data-cost="4"] { background: rgba(168,85,247,0.4); }
  .hex-cell.filled[data-cost="5"] { background: rgba(245,158,11,0.4); }

  .board-label {
    font-family: var(--font-mono);
    font-size: 0.6rem;
    color: var(--text-dim);
    letter-spacing: 0.1em;
    margin-top: 1.5rem;
    opacity: 0.5;
  }

  /* ── RIGHT PANEL: ANALYSIS ── */
  .unit-counter {
    font-family: var(--font-display);
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: var(--text-dim);
    margin-bottom: 0.8rem;
    text-align: center;
  }

  .unit-counter .count {
    color: var(--cyan-glow);
    font-size: 1.1rem;
  }

  .gold-counter {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--gold);
    text-align: center;
    margin-bottom: 1rem;
    padding: 0.4rem;
    border: 1px solid rgba(245,158,11,0.2);
    border-radius: 4px;
    background: rgba(245,158,11,0.05);
  }

  .trait-section-label {
    font-family: var(--font-display);
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    color: var(--text-dim);
    margin-bottom: 0.5rem;
    padding-bottom: 0.3rem;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }

  .trait-list {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    margin-bottom: 1rem;
  }

  .trait-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.35rem 0.5rem;
    border-radius: 4px;
    border: 1px solid rgba(255,255,255,0.05);
    background: rgba(255,255,255,0.02);
    transition: all 0.2s;
    flex-wrap: wrap;
  }

  .trait-item.active-trait {
    border-color: rgba(245,158,11,0.3);
    background: rgba(245,158,11,0.06);
  }

  .trait-item.max-trait {
    border-color: rgba(245,158,11,0.5);
    background: rgba(245,158,11,0.1);
    box-shadow: 0 0 10px rgba(245,158,11,0.08);
  }

  .trait-count-badge {
    font-family: var(--font-display);
    font-size: 0.6rem;
    font-weight: 700;
    min-width: 20px;
    text-align: center;
    color: var(--text-dim);
  }

  .trait-item.active-trait .trait-count-badge { color: var(--gold); }
  .trait-item.max-trait .trait-count-badge { color: var(--gold); text-shadow: 0 0 6px rgba(245,158,11,0.4); }

  .trait-name {
    font-family: var(--font-heading);
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-dim);
    flex: 1;
  }

  .trait-item.active-trait .trait-name { color: var(--text-primary); }
  .trait-item.max-trait .trait-name { color: var(--gold); }

  .trait-thresholds {
    display: flex;
    gap: 2px;
  }

  .trait-pip {
    width: 14px;
    height: 14px;
    border-radius: 2px;
    font-family: var(--font-mono);
    font-size: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid rgba(255,255,255,0.1);
    background: rgba(255,255,255,0.03);
    color: var(--text-dim);
  }

  .trait-pip.met {
    border-color: rgba(245,158,11,0.5);
    background: rgba(245,158,11,0.2);
    color: var(--gold);
  }

  .synergy-bar-wrap {
    width: 100%;
    height: 3px;
    background: rgba(255,255,255,0.06);
    border-radius: 2px;
    margin-top: 3px;
    overflow: hidden;
  }

  .synergy-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--cyan-core), var(--gold));
    border-radius: 2px;
    transition: width 0.3s ease;
  }

  /* ── ACTION BUTTONS ── */
  .actions {
    padding: 0.8rem;
    border-top: 1px solid var(--border-subtle);
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    flex-shrink: 0;
  }

  .action-btn {
    font-family: var(--font-display);
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    padding: 0.5rem 0.8rem;
    border-radius: 5px;
    border: 1px solid;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
    background: transparent;
    color: var(--text-primary);
  }

  .btn-share {
    border-color: var(--cyan-core);
    color: var(--cyan-glow);
  }

  .btn-share:hover {
    background: rgba(6,182,212,0.15);
    box-shadow: 0 0 15px rgba(6,182,212,0.15);
  }

  .btn-save {
    border-color: var(--purple-core);
    color: var(--purple-glow);
  }

  .btn-save:hover {
    background: rgba(139,92,246,0.15);
    box-shadow: 0 0 15px rgba(139,92,246,0.15);
  }

  .btn-clear {
    border-color: rgba(239,68,68,0.4);
    color: var(--danger);
  }

  .btn-clear:hover {
    background: rgba(239,68,68,0.1);
  }

  .saved-slots {
    padding: 0.5rem 0.8rem;
    border-top: 1px solid var(--border-subtle);
    flex-shrink: 0;
  }

  .saved-label {
    font-family: var(--font-display);
    font-size: 0.55rem;
    letter-spacing: 0.12em;
    color: var(--text-dim);
    margin-bottom: 0.4rem;
  }

  .saved-slot-row {
    display: flex;
    gap: 0.3rem;
  }

  .saved-slot {
    flex: 1;
    font-family: var(--font-mono);
    font-size: 0.55rem;
    padding: 0.35rem;
    border-radius: 4px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.02);
    color: var(--text-dim);
    cursor: pointer;
    text-align: center;
    transition: all 0.15s;
  }

  .saved-slot:hover {
    border-color: var(--purple-core);
    color: var(--text-primary);
  }

  .saved-slot.has-data {
    border-color: rgba(139,92,246,0.3);
    color: var(--purple-glow);
  }

  /* ── TOAST ── */
  .toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--text-primary);
    background: var(--void-surface);
    border: 1px solid var(--border-glow);
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    z-index: 10000;
    opacity: 0;
    transition: all 0.3s ease;
    pointer-events: none;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  .no-results {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--text-dim);
    text-align: center;
    padding: 2rem 0.5rem;
    opacity: 0.6;
  }

  .empty-msg {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    color: var(--text-dim);
    text-align: center;
    padding: 1.5rem 0.5rem;
    opacity: 0.4;
  }

  /* ── RESPONSIVE ── */
  @media (max-width: 960px) {
    .builder-wrap {
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr auto;
    }

    .panel, .board-panel {
      border: none !important;
      border-bottom: 1px solid var(--border-subtle) !important;
    }

    .panel:last-child {
      border-bottom: none !important;
    }

    #roster-panel {
      min-height: 260px;
    }

    .panel-body {
      max-height: 45vh;
      min-height: 180px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    #champ-grid {
      min-height: 150px;
    }

    .board-panel {
      min-height: 380px;
    }

    .board-row.offset { margin-left: 38px; }

    .hex-cell { width: 62px; height: 62px; }
  }

  /* ── MOBILE TAP-TO-SELECT ── */
  .champ-card.selected {
    border-color: #06b6d4;
    box-shadow: 0 0 12px #06b6d4;
    transform: scale(1.1);
    z-index: 2;
  }

  .mobile-selection-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 10000;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.6rem 1rem;
    background: rgba(4,6,15,0.95);
    backdrop-filter: blur(12px);
    border-top: 1px solid var(--cyan-core);
    box-shadow: 0 -4px 20px rgba(6,182,212,0.2);
    animation: slideUp 0.2s ease-out;
  }

  @keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
  }

  .mobile-selection-bar img {
    width: 40px;
    height: 40px;
    border-radius: 6px;
    border: 2px solid var(--cyan-core);
    object-fit: cover;
  }

  .mobile-selection-bar .sel-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 1px;
  }

  .mobile-selection-bar .sel-name {
    font-family: var(--font-heading);
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--cyan-glow);
  }

  .mobile-selection-bar .sel-hint {
    font-family: var(--font-mono);
    font-size: 0.6rem;
    color: var(--text-dim);
    letter-spacing: 0.05em;
  }

  .mobile-selection-bar .sel-cancel {
    font-family: var(--font-display);
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    border: 1px solid rgba(239,68,68,0.4);
    background: transparent;
    color: var(--danger);
    cursor: pointer;
  }

  @media (max-width: 520px) {
    .hex-cell { width: 48px; height: 48px; }
    .board-row.offset { margin-left: 28px; }
    .champ-grid { grid-template-columns: repeat(auto-fill, minmax(44px, 1fr)); }
    .champ-card { width: 44px; height: 44px; }
  }
</style>
</head>
<body>

<canvas id="particles-canvas"></canvas>

<nav class="top-nav">
  <a href="./" class="back-link">&larr; COMP HUB</a>
  <h1 class="page-title">TEAM BUILDER</h1>
  <div class="nav-spacer"></div>
</nav>

<div class="builder-wrap">

  <div class="panel" id="roster-panel">
    <div class="panel-header">
      <div class="panel-title">Champion Roster</div>
    </div>
    <div class="panel-body">
      <input type="text" class="search-bar" id="champ-search" placeholder="Search champion or trait...">
      <div class="cost-filters" id="cost-filters"></div>
      <div class="filter-row" id="trait-filters"></div>
      <div class="champ-grid" id="champ-grid"></div>
    </div>
  </div>

  <div class="board-panel" id="board-panel">
    <div class="board-container" id="board-container"></div>
    <div class="board-label" id="board-label">DRAG CHAMPIONS TO THE BOARD</div>
  </div>

  <div class="panel" id="analysis-panel">
    <div class="panel-header">
      <div class="panel-title">Team Analysis</div>
    </div>
    <div class="panel-body" id="analysis-body">
      <div class="unit-counter" id="unit-counter"><span class="count">0</span> / 10 UNITS</div>
      <div class="gold-counter" id="gold-counter">TOTAL COST: 0g</div>
      <div class="trait-section-label">ACTIVE SYNERGIES</div>
      <div class="trait-list" id="trait-list">
        <div class="empty-msg">Place champions to see traits</div>
      </div>
    </div>
    <div class="actions">
      <button class="action-btn btn-share" id="btn-share">COPY SHARE LINK</button>
      <button class="action-btn btn-save" id="btn-save">SAVE SNAPSHOT</button>
      <button class="action-btn btn-clear" id="btn-clear">CLEAR ALL</button>
    </div>
    <div class="saved-slots">
      <div class="saved-label">SAVED BOARDS</div>
      <div class="saved-slot-row" id="saved-slots"></div>
    </div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
/* ═══════════════════════════════════════
   TFT SET 16 — TEAM BUILDER
   ═══════════════════════════════════════ */

const CHAMPIONS=[{id:"TFT16_Anivia",name:"Anivia",cost:1,traits:["Freljord","Invoker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_anivia/hud/tft16_anivia_square.tft_set16.png"},{id:"TFT16_Blitzcrank",name:"Blitzcrank",cost:1,traits:["Zaun","Juggernaut"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_blitzcrank/hud/tft16_blitzcrank_square.tft_set16.png"},{id:"TFT16_Briar",name:"Briar",cost:1,traits:["Noxus","Slayer","Juggernaut"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_briar/hud/tft16_briar_square.tft_set16.png"},{id:"TFT16_Caitlyn",name:"Caitlyn",cost:1,traits:["Piltover","Longshot"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_caitlyn/hud/tft16_caitlyn_square.tft_set16.png"},{id:"TFT16_Illaoi",name:"Illaoi",cost:1,traits:["Bilgewater","Bruiser"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_illaoi/hud/tft16_illaoi_square.tft_set16.png"},{id:"TFT16_JarvanIV",name:"Jarvan IV",cost:1,traits:["Demacia","Defender"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_jarvaniv/hud/tft16_jarvaniv_square.tft_set16.png"},{id:"TFT16_Jhin",name:"Jhin",cost:1,traits:["Ionia","Gunslinger"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_jhin/hud/tft16_jhin_square.tft_set16.png"},{id:"TFT16_KogMaw",name:"Kog'Maw",cost:1,traits:["Void","Arcanist","Longshot"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_kogmaw/hud/tft16_kogmaw_square.tft_set16.png"},{id:"TFT16_Lulu",name:"Lulu",cost:1,traits:["Yordle","Arcanist"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_lulu/hud/tft16_lulu_square.tft_set16.png"},{id:"TFT16_Qiyana",name:"Qiyana",cost:1,traits:["Ixtal","Slayer"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_qiyana/hud/tft16_qiyana_square.tft_set16.png"},{id:"TFT16_Rumble",name:"Rumble",cost:1,traits:["Yordle","Defender"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_rumble/hud/tft16_rumble_square.tft_set16.png"},{id:"TFT16_Shen",name:"Shen",cost:1,traits:["Ionia","Bruiser"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_shen/hud/tft16_shen_square.tft_set16.png"},{id:"TFT16_Sona",name:"Sona",cost:1,traits:["Demacia","Invoker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_sona/hud/tft16_sona_square.tft_set16.png"},{id:"TFT16_Viego",name:"Viego",cost:1,traits:["Shadow Isles","Quickstriker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_viego/hud/tft16_viego_square.tft_set16.png"},{id:"TFT16_Aphelios",name:"Aphelios",cost:2,traits:["Targon"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_aphelios/hud/tft16_aphelios_square.tft_set16.png"},{id:"TFT16_Ashe",name:"Ashe",cost:2,traits:["Freljord","Quickstriker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_ashe/hud/tft16_ashe_square.tft_set16.png"},{id:"TFT16_Bard",name:"Bard",cost:2,traits:["Caretaker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_bard/hud/tft16_bard_square.tft_set16.png"},{id:"TFT16_ChoGath",name:"Cho'Gath",cost:2,traits:["Void","Juggernaut"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_chogath/hud/tft16_chogath_square.tft_set16.png"},{id:"TFT16_Ekko",name:"Ekko",cost:2,traits:["Zaun","Disruptor"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_ekko/hud/tft16_ekko_square.tft_set16.png"},{id:"TFT16_Graves",name:"Graves",cost:2,traits:["Bilgewater","Gunslinger"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_graves/hud/tft16_graves_square.tft_set16.png"},{id:"TFT16_Neeko",name:"Neeko",cost:2,traits:["Ixtal","Arcanist","Defender"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_neeko/hud/tft16_neeko_square.tft_set16.png"},{id:"TFT16_Orianna",name:"Orianna",cost:2,traits:["Piltover","Invoker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_orianna/hud/tft16_orianna_square.tft_set16.png"},{id:"TFT16_Poppy",name:"Poppy",cost:2,traits:["Demacia","Yordle","Juggernaut"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_poppy/hud/tft16_poppy_square.tft_set16.png"},{id:"TFT16_RekSai",name:"Rek'Sai",cost:2,traits:["Void","Vanquisher"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_reksai/hud/tft16_reksai_square.tft_set16.png"},{id:"TFT16_Sion",name:"Sion",cost:2,traits:["Noxus","Bruiser"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_sion/hud/tft16_sion_square.tft_set16.png"},{id:"TFT16_Teemo",name:"Teemo",cost:2,traits:["Yordle","Longshot"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_teemo/hud/tft16_teemo_square.tft_set16.png"},{id:"TFT16_Tristana",name:"Tristana",cost:2,traits:["Yordle","Gunslinger"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_tristana/hud/tft16_tristana_square.tft_set16.png"},{id:"TFT16_Tryndamere",name:"Tryndamere",cost:2,traits:["Freljord","Slayer"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_tryndamere/hud/tft16_tryndamere_square.tft_set16.png"},{id:"TFT16_TwistedFate",name:"Twisted Fate",cost:2,traits:["Bilgewater","Quickstriker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_twistedfate/hud/tft16_twistedfate_square.tft_set16.png"},{id:"TFT16_Vi",name:"Vi",cost:2,traits:["Piltover","Zaun","Defender"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_vi/hud/tft16_vi_square.tft_set16.png"},{id:"TFT16_XinZhao",name:"Xin Zhao",cost:2,traits:["Demacia","Ionia","Warden"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_xinzhao/hud/tft16_xinzhao_square.tft_set16.png"},{id:"TFT16_Yasuo",name:"Yasuo",cost:2,traits:["Ionia","Slayer"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_yasuo/hud/tft16_yasuo_square.tft_set16.png"},{id:"TFT16_Yorick",name:"Yorick",cost:2,traits:["Shadow Isles","Warden"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_yorick/hud/tft16_yorick_square.tft_set16.png"},{id:"TFT16_Ahri",name:"Ahri",cost:3,traits:["Ionia","Arcanist"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_ahri/hud/tft16_ahri_square.tft_set16.png"},{id:"TFT16_Darius",name:"Darius",cost:3,traits:["Noxus","Defender"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_darius/hud/tft16_darius_square.tft_set16.png"},{id:"TFT16_DrMundo",name:"Dr. Mundo",cost:3,traits:["Zaun","Bruiser"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_drmundo/hud/tft16_drmundo_square.tft_set16.png"},{id:"TFT16_Draven",name:"Draven",cost:3,traits:["Noxus","Quickstriker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_draven/hud/tft16_draven_square.tft_set16.png"},{id:"TFT16_Gangplank",name:"Gangplank",cost:3,traits:["Bilgewater","Slayer","Vanquisher"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_gangplank/hud/tft16_gangplank_square.tft_set16.png"},{id:"TFT16_Gwen",name:"Gwen",cost:3,traits:["Shadow Isles","Disruptor"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_gwen/hud/tft16_gwen_square.tft_set16.png"},{id:"TFT16_Jinx",name:"Jinx",cost:3,traits:["Zaun","Gunslinger"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_jinx/hud/tft16_jinx_square.tft_set16.png"},{id:"TFT16_Kennen",name:"Kennen",cost:3,traits:["Ionia","Yordle","Defender"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_kennen/hud/tft16_kennen_square.tft_set16.png"},{id:"TFT16_Kobuko",name:"Kobuko & Yuumi",cost:3,traits:["Yordle","Bruiser","Invoker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_kobuko/hud/tft16_kobuko_square.tft_set16.png"},{id:"TFT16_Leblanc",name:"LeBlanc",cost:3,traits:["Noxus","Invoker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_leblanc/hud/tft16_leblanc_square.tft_set16.png"},{id:"TFT16_Leona",name:"Leona",cost:3,traits:["Targon"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_leona/hud/tft16_leona_square.tft_set16.png"},{id:"TFT16_Loris",name:"Loris",cost:3,traits:["Piltover","Warden"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_loris/hud/tft16_loris_square.tft_set16.png"},{id:"TFT16_Malzahar",name:"Malzahar",cost:3,traits:["Void","Disruptor"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_malzahar/hud/tft16_malzahar_square.tft_set16.png"},{id:"TFT16_Milio",name:"Milio",cost:3,traits:["Ixtal","Invoker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_milio/hud/tft16_milio_square.tft_set16.png"},{id:"TFT16_Nautilus",name:"Nautilus",cost:3,traits:["Bilgewater","Juggernaut","Warden"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_nautilus/hud/tft16_nautilus_square.tft_set16.png"},{id:"TFT16_Sejuani",name:"Sejuani",cost:3,traits:["Freljord","Defender"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_sejuani/hud/tft16_sejuani_square.tft_set16.png"},{id:"TFT16_Vayne",name:"Vayne",cost:3,traits:["Demacia","Longshot"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_vayne/hud/tft16_vayne_square.tft_set16.png"},{id:"TFT16_Zoe",name:"Zoe",cost:3,traits:["Targon"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_zoe/hud/tft16_zoe_square.tft_set16.png"},{id:"TFT16_Ambessa",name:"Ambessa",cost:4,traits:["Noxus","Vanquisher"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_ambessa/hud/tft16_ambessa_square.tft_set16.png"},{id:"TFT16_BelVeth",name:"Bel'Veth",cost:4,traits:["Void","Slayer"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_belveth/hud/tft16_belveth_square.tft_set16.png"},{id:"TFT16_Braum",name:"Braum",cost:4,traits:["Freljord","Warden"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_braum/hud/tft16_braum_square.tft_set16.png"},{id:"TFT16_Diana",name:"Diana",cost:4,traits:["Targon"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_diana/hud/tft16_diana_square.tft_set16.png"},{id:"TFT16_Fizz",name:"Fizz",cost:4,traits:["Bilgewater","Yordle"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_fizz/hud/tft16_fizz_square.tft_set16.png"},{id:"TFT16_Garen",name:"Garen",cost:4,traits:["Demacia","Defender"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_garen/hud/tft16_garen_square.tft_set16.png"},{id:"TFT16_Kaisa",name:"Kai'Sa",cost:4,traits:["Assimilator","Void","Longshot"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_kaisa/hud/tft16_kaisa_square.tft_set16.png"},{id:"TFT16_Kalista",name:"Kalista",cost:4,traits:["Shadow Isles","Vanquisher"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_kalista/hud/tft16_kalista_square.tft_set16.png"},{id:"TFT16_Lissandra",name:"Lissandra",cost:4,traits:["Freljord","Invoker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_lissandra/hud/tft16_lissandra_square.tft_set16.png"},{id:"TFT16_Lux",name:"Lux",cost:4,traits:["Demacia","Arcanist"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_lux/hud/tft16_lux_square.tft_set16.png"},{id:"TFT16_MissFortune",name:"Miss Fortune",cost:4,traits:["Bilgewater","Gunslinger"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_missfortune/hud/tft16_missfortune_square.tft_set16.png"},{id:"TFT16_Nasus",name:"Nasus",cost:4,traits:["Shurima"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_nasus/hud/tft16_nasus_square.tft_set16.png"},{id:"TFT16_Nidalee",name:"Nidalee",cost:4,traits:["Ixtal","Huntress"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_nidalee/hud/tft16_nidalee_square.tft_set16.png"},{id:"TFT16_Renekton",name:"Renekton",cost:4,traits:["Shurima"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_renekton/hud/tft16_renekton_square.tft_set16.png"},{id:"TFT16_RiftHerald",name:"Rift Herald",cost:4,traits:["Void","Bruiser"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_riftherald/hud/tft16_riftherald_square.tft_set16.png"},{id:"TFT16_Seraphine",name:"Seraphine",cost:4,traits:["Piltover","Disruptor"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_seraphine/hud/tft16_seraphine_square.tft_set16.png"},{id:"TFT16_Singed",name:"Singed",cost:4,traits:["Zaun","Juggernaut"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_singed/hud/tft16_singed_square.tft_set16.png"},{id:"TFT16_Skarner",name:"Skarner",cost:4,traits:["Ixtal"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_skarner/hud/tft16_skarner_square.tft_set16.png"},{id:"TFT16_Swain",name:"Swain",cost:4,traits:["Noxus","Arcanist","Juggernaut"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_swain/hud/tft16_swain_square.tft_set16.png"},{id:"TFT16_Taric",name:"Taric",cost:4,traits:["Targon"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_taric/hud/tft16_taric_square.tft_set16.png"},{id:"TFT16_Veigar",name:"Veigar",cost:4,traits:["Yordle","Arcanist"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_veigar/hud/tft16_veigar_square.tft_set16.png"},{id:"TFT16_Warwick",name:"Warwick",cost:4,traits:["Zaun","Quickstriker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_warwick/hud/tft16_warwick_square.tft_set16.png"},{id:"TFT16_Wukong",name:"Wukong",cost:4,traits:["Ionia","Bruiser"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_wukong/hud/tft16_wukong_square.tft_set16.png"},{id:"TFT16_Yone",name:"Yone",cost:4,traits:["Ionia","Slayer"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_yone/hud/tft16_yone_square.tft_set16.png"},{id:"TFT16_Yunara",name:"Yunara",cost:4,traits:["Ionia","Quickstriker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_yunara/hud/tft16_yunara_square.tft_set16.png"},{id:"TFT16_Aatrox",name:"Aatrox",cost:5,traits:["Darkin","World Ender","Slayer"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_aatrox/hud/tft16_aatrox_square.tft_set16.png"},{id:"TFT16_Annie",name:"Annie",cost:5,traits:["Dark Child","Arcanist"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_annie/hud/tft16_annie_square.tft_set16.png"},{id:"TFT16_AurelionSol",name:"Aurelion Sol",cost:5,traits:["Star Forger","Targon"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_aurelionsol/hud/tft16_aurelionsol_square.tft_set16.png"},{id:"TFT16_Azir",name:"Azir",cost:5,traits:["Shurima","Emperor","Disruptor"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_azir/hud/tft16_azir_square.tft_set16.png"},{id:"TFT16_BaronNashor",name:"Baron Nashor",cost:5,traits:["Void","Riftscourge"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_baronnashor/hud/tft16_baronnashor_square.tft_set16.png"},{id:"TFT16_Brock",name:"Brock",cost:5,traits:["Ixtal"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_brock/hud/tft16_brock_square.tft_set16.png"},{id:"TFT16_Fiddlesticks",name:"Fiddlesticks",cost:5,traits:["Harvester","Vanquisher"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_fiddlesticks/hud/tft16_fiddlesticks_square.tft_set16.png"},{id:"TFT16_Galio",name:"Galio",cost:5,traits:["Demacia","Heroic"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_galio/hud/tft16_galio_square.tft_set16.png"},{id:"TFT16_Kindred",name:"Kindred",cost:5,traits:["Eternal","Quickstriker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_kindred/hud/tft16_kindred_square.tft_set16.png"},{id:"TFT16_Lucian",name:"Lucian & Senna",cost:5,traits:["Soulbound","Gunslinger"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_lucian/hud/tft16_lucian_square.tft_set16.png"},{id:"TFT16_Mel",name:"Mel",cost:5,traits:["Noxus","Disruptor"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_mel/hud/tft16_mel_square.tft_set16.png"},{id:"TFT16_Ornn",name:"Ornn",cost:5,traits:["Blacksmith","Warden"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_ornn/hud/tft16_ornn_square.tft_set16.png"},{id:"TFT16_Ryze",name:"Ryze",cost:5,traits:["Rune Mage"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_ryze/hud/tft16_ryze_square.tft_set16.png"},{id:"TFT16_Sett",name:"Sett",cost:5,traits:["Ionia","The Boss"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_sett/hud/tft16_sett_square.tft_set16.png"},{id:"TFT16_Shyvana",name:"Shyvana",cost:5,traits:["Dragonborn","Juggernaut"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_shyvana/hud/tft16_shyvana_square.tft_set16.png"},{id:"TFT16_Sylas",name:"Sylas",cost:5,traits:["Chainbreaker","Arcanist","Defender"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_sylas/hud/tft16_sylas_square.tft_set16.png"},{id:"TFT16_THex",name:"T-Hex",cost:5,traits:["HexMech","Piltover","Gunslinger"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_thex/hud/tft16_thex_square.tft_set16.png"},{id:"TFT16_TahmKench",name:"Tahm Kench",cost:5,traits:["Bilgewater","Glutton","Bruiser"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_tahmkench/hud/tft16_tahmkench_square.tft_set16.png"},{id:"TFT16_Thresh",name:"Thresh",cost:5,traits:["Shadow Isles","Warden"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_thresh/hud/tft16_thresh_square.tft_set16.png"},{id:"TFT16_Volibear",name:"Volibear",cost:5,traits:["Freljord","Bruiser"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_volibear/hud/tft16_volibear_square.tft_set16.png"},{id:"TFT16_Xerath",name:"Xerath",cost:5,traits:["Shurima","Ascendant"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_xerath/hud/tft16_xerath_square.tft_set16.png"},{id:"TFT16_Zaahen",name:"Zaahen",cost:5,traits:["Darkin","Immortal"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_zaahen/hud/tft16_zaahen_square.tft_set16.png"},{id:"TFT16_Ziggs",name:"Ziggs",cost:5,traits:["Zaun","Yordle","Longshot"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_ziggs/hud/tft16_ziggs_square.tft_set16.png"},{id:"TFT16_Zilean",name:"Zilean",cost:5,traits:["Chronokeeper","Invoker"],img:"https://raw.communitydragon.org/latest/game/assets/characters/tft16_zilean/hud/tft16_zilean_square.tft_set16.png"}];

const TRAITS=[{id:"TFT16_Sorcerer",name:"Arcanist",thresholds:[2,4,6]},{id:"TFT16_XerathUnique",name:"Ascendant",thresholds:[1]},{id:"TFT16_KaisaUnique",name:"Assimilator",thresholds:[1]},{id:"TFT16_Bilgewater",name:"Bilgewater",thresholds:[3,5,7,10]},{id:"TFT16_Blacksmith",name:"Blacksmith",thresholds:[1]},{id:"TFT16_Brawler",name:"Bruiser",thresholds:[2,4,6]},{id:"TFT16_Caretaker",name:"Caretaker",thresholds:[1]},{id:"TFT16_SylasTrait",name:"Chainbreaker",thresholds:[1]},{id:"TFT16_Teamup_AmbessaKindred",name:"Chosen Wolves",thresholds:[2]},{id:"TFT16_Chronokeeper",name:"Chronokeeper",thresholds:[1]},{id:"TFT16_DarkChild",name:"Dark Child",thresholds:[1]},{id:"TFT16_DarkinWeapon",name:"Darkin",thresholds:[1,2,3]},{id:"TFT16_Defender",name:"Defender",thresholds:[2,4,6]},{id:"TFT16_Demacia",name:"Demacia",thresholds:[3,5,7,11]},{id:"TFT16_Magus",name:"Disruptor",thresholds:[2,4]},{id:"TFT16_ShyvanaUnique",name:"Dragonborn",thresholds:[1]},{id:"TFT16_Teamup_JarvanShyvana",name:"Dragonguards",thresholds:[2]},{id:"TFT16_Emperor",name:"Emperor",thresholds:[1]},{id:"TFT16_KindredUnique",name:"Eternal",thresholds:[1]},{id:"TFT16_Freljord",name:"Freljord",thresholds:[3,5,7]},{id:"TFT16_Glutton",name:"Glutton",thresholds:[1]},{id:"TFT16_Gunslinger",name:"Gunslinger",thresholds:[2,4]},{id:"TFT16_Harvester",name:"Harvester",thresholds:[1]},{id:"TFT16_Heroic",name:"Heroic",thresholds:[1]},{id:"TFT16_HexMech",name:"HexMech",thresholds:[1]},{id:"TFT16_Huntress",name:"Huntress",thresholds:[1]},{id:"TFT16_ZaahenTrait",name:"Immortal",thresholds:[1]},{id:"TFT16_Invoker",name:"Invoker",thresholds:[2,4]},{id:"TFT16_Ionia",name:"Ionia",thresholds:[3,5,7,10]},{id:"TFT16_Explorer",name:"Ixtal",thresholds:[3,5,7]},{id:"TFT16_Juggernaut",name:"Juggernaut",thresholds:[2,4,6]},{id:"TFT16_Longshot",name:"Longshot",thresholds:[2,3,4,5]},{id:"TFT16_Noxus",name:"Noxus",thresholds:[3,5,7,10]},{id:"TFT16_Piltover",name:"Piltover",thresholds:[2,4,6]},{id:"TFT16_Teamup_SingedTeemo",name:"Poison Pals",thresholds:[2]},{id:"TFT16_Rapidfire",name:"Quickstriker",thresholds:[2,3,4,5]},{id:"TFT16_BaronUnique",name:"Riftscourge",thresholds:[1]},{id:"TFT16_RuneMage",name:"Rune Mage",thresholds:[1]},{id:"TFT16_Teamup_LucianVayne",name:"Sentinels of Light",thresholds:[2]},{id:"TFT16_ShadowIsles",name:"Shadow Isles",thresholds:[2,3,4,5]},{id:"TFT16_Shurima",name:"Shurima",thresholds:[2,3,4]},{id:"TFT16_Slayer",name:"Slayer",thresholds:[2,4,6]},{id:"TFT16_Soulbound",name:"Soulbound",thresholds:[1]},{id:"TFT16_AurelionSolUnique",name:"Star Forger",thresholds:[1]},{id:"TFT16_Targon",name:"Targon",thresholds:[1]},{id:"TFT16_TheBoss",name:"The Boss",thresholds:[1]},{id:"TFT16_Teamup_EkkoZilean",name:"Timewinders",thresholds:[1,2]},{id:"TFT16_Vanquisher",name:"Vanquisher",thresholds:[2,3,4,5]},{id:"TFT16_Void",name:"Void",thresholds:[2,4,6,9]},{id:"TFT16_Warden",name:"Warden",thresholds:[2,3,4,5]},{id:"TFT16_AatroxUnique",name:"World Ender",thresholds:[1]},{id:"TFT16_Yordle",name:"Yordle",thresholds:[2,4,6,8,10]},{id:"TFT16_Zaun",name:"Zaun",thresholds:[3,5,7]}];

const ROWS = 4, COLS = 7;
const champMap = Object.create(null);
CHAMPIONS.forEach(function(c) { champMap[c.id] = c; });

const board = Array.from({length: ROWS}, function() { return Array(COLS).fill(null); });

const champTraitNames = Array.from(new Set(CHAMPIONS.flatMap(function(c) { return c.traits; }))).sort();

/* ── INIT ── */
function init() {
  buildCostFilters();
  buildTraitFilters();
  renderRoster();
  buildBoard();
  renderAnalysis();
  loadFromHash();
  renderSavedSlots();

  document.getElementById('champ-search').addEventListener('input', renderRoster);
  document.getElementById('btn-share').addEventListener('click', shareBoard);
  document.getElementById('btn-save').addEventListener('click', saveSnapshot);
  document.getElementById('btn-clear').addEventListener('click', clearBoard);

  window.addEventListener('hashchange', loadFromHash);

  // Update label for touch devices
  if (isTouchDevice) {
    var label = document.getElementById('board-label');
    if (label) label.textContent = 'TAP A CHAMPION, THEN TAP A HEX';
  }
}

/* ── COST FILTERS ── */
var activeCosts = new Set();
function buildCostFilters() {
  var wrap = document.getElementById('cost-filters');
  for (var c = 1; c <= 5; c++) {
    (function(cost) {
      var pill = document.createElement('div');
      pill.className = 'cost-pill';
      pill.dataset.cost = cost;
      pill.textContent = cost + '\u2605';
      pill.addEventListener('click', function() {
        if (activeCosts.has(cost)) activeCosts.delete(cost);
        else activeCosts.add(cost);
        pill.classList.toggle('active');
        renderRoster();
      });
      wrap.appendChild(pill);
    })(c);
  }
}

/* ── TRAIT FILTERS ── */
var activeTraitFilter = null;
function buildTraitFilters() {
  var wrap = document.getElementById('trait-filters');
  champTraitNames.forEach(function(t) {
    var pill = document.createElement('div');
    pill.className = 'filter-pill';
    pill.textContent = t;
    pill.addEventListener('click', function() {
      if (activeTraitFilter === t) {
        activeTraitFilter = null;
        pill.classList.remove('active');
      } else {
        wrap.querySelectorAll('.filter-pill').forEach(function(p) { p.classList.remove('active'); });
        activeTraitFilter = t;
        pill.classList.add('active');
      }
      renderRoster();
    });
    wrap.appendChild(pill);
  });
}

/* ── ROSTER ── */
function getOnBoardIds() {
  var ids = new Set();
  for (var r = 0; r < ROWS; r++)
    for (var c = 0; c < COLS; c++)
      if (board[r][c]) ids.add(board[r][c]);
  return ids;
}

function renderRoster() {
  var grid = document.getElementById('champ-grid');
  var query = document.getElementById('champ-search').value.toLowerCase().trim();
  var onBoard = getOnBoardIds();

  var filtered = CHAMPIONS.filter(function(ch) {
    if (activeCosts.size > 0 && !activeCosts.has(ch.cost)) return false;
    if (activeTraitFilter && ch.traits.indexOf(activeTraitFilter) === -1) return false;
    if (query) {
      var nameMatch = ch.name.toLowerCase().indexOf(query) !== -1;
      var traitMatch = ch.traits.some(function(t) { return t.toLowerCase().indexOf(query) !== -1; });
      if (!nameMatch && !traitMatch) return false;
    }
    return true;
  });

  // Clear using DOM methods
  while (grid.firstChild) grid.removeChild(grid.firstChild);

  if (filtered.length === 0) {
    var msg = document.createElement('div');
    msg.className = 'no-results';
    msg.textContent = 'No champions match';
    grid.appendChild(msg);
    return;
  }

  filtered.forEach(function(ch) {
    var isOnBoard = onBoard.has(ch.id);
    var card = document.createElement('div');
    card.className = 'champ-card' + (isOnBoard ? ' on-board' : '');
    card.dataset.cost = ch.cost;
    card.dataset.champId = ch.id;
    card.draggable = !isOnBoard;

    var img = document.createElement('img');
    img.src = ch.img;
    img.alt = ch.name;
    img.loading = 'lazy';
    card.appendChild(img);

    var tip = document.createElement('span');
    tip.className = 'champ-name-tip';
    tip.textContent = ch.name;
    card.appendChild(tip);

    card.addEventListener('dragstart', function(e) {
      e.dataTransfer.setData('text/plain', ch.id);
      e.dataTransfer.setData('source', 'roster');
      card.classList.add('dragging');
    });
    card.addEventListener('dragend', function() { card.classList.remove('dragging'); });

    // Mobile tap-to-select
    if (isTouchDevice && !isOnBoard) {
      (function(champId, cardEl) {
        cardEl.addEventListener('click', function(e) {
          e.stopPropagation();
          if (selectedChampId === champId) {
            deselectChampion();
          } else {
            deselectChampion();
            selectedChampId = champId;
            cardEl.classList.add('selected');
            showSelectionBar(champId);
          }
        });
      })(ch.id, card);
    }

    setupTouchDrag(card, ch.id, 'roster');

    grid.appendChild(card);
  });

  console.log('[Builder] renderRoster: ' + filtered.length + ' champions rendered');
}

/* ── HEX BOARD ── */
function buildBoard() {
  var container = document.getElementById('board-container');
  while (container.firstChild) container.removeChild(container.firstChild);
  for (var r = 0; r < ROWS; r++) {
    var row = document.createElement('div');
    row.className = 'board-row' + (r % 2 === 1 ? ' offset' : '');
    for (var c = 0; c < COLS; c++) {
      row.appendChild(createHexCell(r, c));
    }
    container.appendChild(row);
  }
}

function createHexCell(r, c) {
  var hex = document.createElement('div');
  hex.className = 'hex-cell empty';
  hex.dataset.row = r;
  hex.dataset.col = c;

  var inner = document.createElement('div');
  inner.className = 'hex-cell-inner';
  var plus = document.createElement('span');
  plus.className = 'hex-plus';
  plus.textContent = '+';
  inner.appendChild(plus);
  hex.appendChild(inner);

  hex.addEventListener('dragover', function(e) { e.preventDefault(); hex.classList.add('drag-over'); });
  hex.addEventListener('dragleave', function() { hex.classList.remove('drag-over'); });
  hex.addEventListener('drop', function(e) {
    e.preventDefault();
    hex.classList.remove('drag-over');
    var champId = e.dataTransfer.getData('text/plain');
    var source = e.dataTransfer.getData('source');
    if (source === 'board') {
      var sr = parseInt(e.dataTransfer.getData('srcRow'), 10);
      var sc = parseInt(e.dataTransfer.getData('srcCol'), 10);
      var existing = board[r][c];
      board[r][c] = board[sr][sc];
      board[sr][sc] = existing;
    } else {
      if (board[r][c]) return;
      board[r][c] = champId;
    }
    refreshBoard();
  });

  hex.addEventListener('click', function() {
    // Mobile tap-to-place: if a champion is selected and this hex is empty, place it
    if (isTouchDevice && selectedChampId && !board[r][c]) {
      board[r][c] = selectedChampId;
      deselectChampion();
      refreshBoard();
      return;
    }
    if (board[r][c]) {
      board[r][c] = null;
      refreshBoard();
    }
  });

  return hex;
}

function refreshBoard() {
  var container = document.getElementById('board-container');
  for (var r = 0; r < ROWS; r++) {
    var rowEl = container.children[r];
    for (var c = 0; c < COLS; c++) {
      var hex = rowEl.children[c];
      var champId = board[r][c];
      var inner = hex.querySelector('.hex-cell-inner');

      var oldTag = hex.querySelector('.hex-name-tag');
      if (oldTag) oldTag.remove();

      // Remove old dragstart listeners by replacing hex event handling
      var newHex = hex;

      if (champId && champMap[champId]) {
        var ch = champMap[champId];
        newHex.className = 'hex-cell filled';
        newHex.dataset.cost = ch.cost;

        while (inner.firstChild) inner.removeChild(inner.firstChild);

        var img = document.createElement('img');
        img.className = 'hex-portrait';
        img.src = ch.img;
        img.alt = ch.name;
        inner.appendChild(img);

        var removeBtn = document.createElement('button');
        removeBtn.className = 'hex-remove';
        removeBtn.textContent = '\u00d7';
        (function(row, col) {
          removeBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            board[row][col] = null;
            refreshBoard();
          });
        })(r, c);
        inner.appendChild(removeBtn);

        var tag = document.createElement('div');
        tag.className = 'hex-name-tag';
        tag.textContent = ch.name;
        newHex.appendChild(tag);

        newHex.draggable = true;
        (function(cid, row, col) {
          newHex.ondragstart = function(e) {
            e.dataTransfer.setData('text/plain', cid);
            e.dataTransfer.setData('source', 'board');
            e.dataTransfer.setData('srcRow', String(row));
            e.dataTransfer.setData('srcCol', String(col));
          };
          setupTouchDrag(newHex, cid, 'board', row, col);
        })(champId, r, c);
      } else {
        newHex.className = 'hex-cell empty';
        delete newHex.dataset.cost;
        newHex.draggable = false;
        newHex.ondragstart = null;
        while (inner.firstChild) inner.removeChild(inner.firstChild);
        var plus = document.createElement('span');
        plus.className = 'hex-plus';
        plus.textContent = '+';
        inner.appendChild(plus);
      }
    }
  }
  // Clear mobile selection when board changes
  if (selectedChampId) {
    var stillValid = !getOnBoardIds().has(selectedChampId);
    if (!stillValid) deselectChampion();
  }
  renderRoster();
  renderAnalysis();
  updateHash();
}

/* ── ANALYSIS ── */
function renderAnalysis() {
  var onBoard = [];
  for (var r = 0; r < ROWS; r++)
    for (var c = 0; c < COLS; c++)
      if (board[r][c] && champMap[board[r][c]]) onBoard.push(champMap[board[r][c]]);

  var counter = document.getElementById('unit-counter');
  while (counter.firstChild) counter.removeChild(counter.firstChild);
  var countSpan = document.createElement('span');
  countSpan.className = 'count';
  countSpan.textContent = onBoard.length;
  counter.appendChild(countSpan);
  counter.appendChild(document.createTextNode(' / 10 UNITS'));

  var gold = onBoard.reduce(function(s, ch) { return s + ch.cost; }, 0);
  document.getElementById('gold-counter').textContent = 'TOTAL COST: ' + gold + 'g';

  var traitCounts = Object.create(null);
  onBoard.forEach(function(ch) {
    ch.traits.forEach(function(t) {
      traitCounts[t] = (traitCounts[t] || 0) + 1;
    });
  });

  var traitList = document.getElementById('trait-list');
  while (traitList.firstChild) traitList.removeChild(traitList.firstChild);

  if (Object.keys(traitCounts).length === 0) {
    var empty = document.createElement('div');
    empty.className = 'empty-msg';
    empty.textContent = 'Place champions to see traits';
    traitList.appendChild(empty);
    return;
  }

  var traitEntries = Object.keys(traitCounts).map(function(name) {
    var count = traitCounts[name];
    var traitDef = TRAITS.find(function(t) { return t.name === name; });
    var thresholds = traitDef ? traitDef.thresholds : [];
    var metIdx = thresholds.reduce(function(best, th, i) { return count >= th ? i : best; }, -1);
    var maxMet = metIdx === thresholds.length - 1 && metIdx >= 0;
    return { name: name, count: count, thresholds: thresholds, metIdx: metIdx, maxMet: maxMet };
  });

  traitEntries.sort(function(a, b) {
    if (a.maxMet !== b.maxMet) return (b.maxMet ? 1 : 0) - (a.maxMet ? 1 : 0);
    if (a.metIdx !== b.metIdx) return b.metIdx - a.metIdx;
    return b.count - a.count;
  });

  traitEntries.forEach(function(entry) {
    var item = document.createElement('div');
    var isActive = entry.metIdx >= 0;
    item.className = 'trait-item' + (entry.maxMet ? ' max-trait' : isActive ? ' active-trait' : '');

    var badge = document.createElement('span');
    badge.className = 'trait-count-badge';
    badge.textContent = entry.count;
    item.appendChild(badge);

    var nameEl = document.createElement('span');
    nameEl.className = 'trait-name';
    nameEl.textContent = entry.name;
    item.appendChild(nameEl);

    var pips = document.createElement('span');
    pips.className = 'trait-thresholds';
    entry.thresholds.forEach(function(th) {
      var pip = document.createElement('span');
      pip.className = 'trait-pip' + (entry.count >= th ? ' met' : '');
      pip.textContent = th;
      pips.appendChild(pip);
    });
    item.appendChild(pips);

    if (entry.thresholds.length > 1) {
      var barWrap = document.createElement('div');
      barWrap.className = 'synergy-bar-wrap';
      var maxTh = entry.thresholds[entry.thresholds.length - 1];
      var pct = Math.min(100, (entry.count / maxTh) * 100);
      var fill = document.createElement('div');
      fill.className = 'synergy-bar-fill';
      fill.style.width = pct + '%';
      barWrap.appendChild(fill);
      item.appendChild(barWrap);
    }

    traitList.appendChild(item);
  });
}

/* ── URL STATE ── */
function updateHash() {
  var entries = [];
  for (var r = 0; r < ROWS; r++)
    for (var c = 0; c < COLS; c++)
      if (board[r][c]) entries.push({ id: board[r][c], r: r, c: c });
  if (entries.length === 0) {
    history.replaceState(null, '', location.pathname);
    return;
  }
  var b64 = btoa(JSON.stringify(entries));
  history.replaceState(null, '', '#board=' + b64);
}

function loadFromHash() {
  var hash = location.hash;
  if (hash.indexOf('#board=') !== 0) return;
  try {
    var b64 = hash.slice(7);
    var entries = JSON.parse(atob(b64));
    for (var r = 0; r < ROWS; r++)
      for (var c = 0; c < COLS; c++)
        board[r][c] = null;
    entries.forEach(function(e) {
      if (e.r >= 0 && e.r < ROWS && e.c >= 0 && e.c < COLS && champMap[e.id])
        board[e.r][e.c] = e.id;
    });
    refreshBoard();
  } catch (err) { /* invalid hash */ }
}

/* ── SHARE ── */
function shareBoard() {
  navigator.clipboard.writeText(location.href).then(function() {
    showToast('Link copied to clipboard!');
  }).catch(function() {
    showToast('Copy the URL from the address bar');
  });
}

/* ── SAVE / LOAD ── */
function saveSnapshot() {
  var entries = [];
  for (var r = 0; r < ROWS; r++)
    for (var c = 0; c < COLS; c++)
      if (board[r][c]) entries.push({ id: board[r][c], r: r, c: c });
  if (entries.length === 0) { showToast('Board is empty'); return; }

  var saves = [];
  try { saves = JSON.parse(localStorage.getItem('tft_builder_saves') || '[]'); } catch(e) {}
  if (saves.length >= 3) saves.shift();
  saves.push({ entries: entries, ts: Date.now() });
  localStorage.setItem('tft_builder_saves', JSON.stringify(saves));
  renderSavedSlots();
  showToast('Board saved!');
}

function renderSavedSlots() {
  var wrap = document.getElementById('saved-slots');
  while (wrap.firstChild) wrap.removeChild(wrap.firstChild);
  var saves = [];
  try { saves = JSON.parse(localStorage.getItem('tft_builder_saves') || '[]'); } catch(e) {}

  for (var i = 0; i < 3; i++) {
    var slot = document.createElement('div');
    slot.className = 'saved-slot' + (saves[i] ? ' has-data' : '');
    if (saves[i]) {
      slot.textContent = saves[i].entries.length + ' units';
      (function(idx) {
        slot.addEventListener('click', function() { loadSlot(idx); });
      })(i);
    } else {
      slot.textContent = 'Empty';
    }
    wrap.appendChild(slot);
  }
}

function loadSlot(idx) {
  var saves = [];
  try { saves = JSON.parse(localStorage.getItem('tft_builder_saves') || '[]'); } catch(e) {}
  if (!saves[idx]) return;
  for (var r = 0; r < ROWS; r++)
    for (var c = 0; c < COLS; c++)
      board[r][c] = null;
  saves[idx].entries.forEach(function(e) {
    if (e.r >= 0 && e.r < ROWS && e.c >= 0 && e.c < COLS && champMap[e.id])
      board[e.r][e.c] = e.id;
  });
  refreshBoard();
  showToast('Board loaded!');
}

/* ── CLEAR ── */
function clearBoard() {
  for (var r = 0; r < ROWS; r++)
    for (var c = 0; c < COLS; c++)
      board[r][c] = null;
  refreshBoard();
}

/* ── TOAST ── */
function showToast(msg) {
  var el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(function() { el.classList.remove('show'); }, 2000);
}

/* ── MOBILE TAP-TO-SELECT ── */
var selectedChampId = null;
var isTouchDevice = window.matchMedia('(pointer: coarse)').matches;
var selectionBar = null;

function showSelectionBar(champId) {
  hideSelectionBar();
  var ch = champMap[champId];
  if (!ch) return;
  selectionBar = document.createElement('div');
  selectionBar.className = 'mobile-selection-bar';

  var img = document.createElement('img');
  img.src = ch.img;
  img.alt = ch.name;
  selectionBar.appendChild(img);

  var info = document.createElement('div');
  info.className = 'sel-info';
  var nameEl = document.createElement('div');
  nameEl.className = 'sel-name';
  nameEl.textContent = ch.name;
  info.appendChild(nameEl);
  var hint = document.createElement('div');
  hint.className = 'sel-hint';
  hint.textContent = 'TAP A HEX TO PLACE';
  info.appendChild(hint);
  selectionBar.appendChild(info);

  var cancel = document.createElement('button');
  cancel.className = 'sel-cancel';
  cancel.textContent = 'CANCEL';
  cancel.addEventListener('click', function(e) {
    e.stopPropagation();
    deselectChampion();
  });
  selectionBar.appendChild(cancel);

  document.body.appendChild(selectionBar);
}

function hideSelectionBar() {
  if (selectionBar) {
    selectionBar.remove();
    selectionBar = null;
  }
}

function deselectChampion() {
  selectedChampId = null;
  hideSelectionBar();
  var prev = document.querySelector('.champ-card.selected');
  if (prev) prev.classList.remove('selected');
}

/* ── TOUCH DRAG ── */
var touchGhost = null;
var touchDragChampId = null;
var touchDragSource = null;
var touchDragSrcRow = null;
var touchDragSrcCol = null;

function setupTouchDrag(el, champId, source, row, col) {
  el.addEventListener('touchstart', function(e) {
    if (source === 'roster' && el.classList.contains('on-board')) return;
    var touch = e.touches[0];
    touchDragChampId = champId;
    touchDragSource = source;
    touchDragSrcRow = row !== undefined ? row : null;
    touchDragSrcCol = col !== undefined ? col : null;

    touchGhost = document.createElement('div');
    touchGhost.style.cssText = 'position:fixed;z-index:10001;width:52px;height:52px;border-radius:6px;overflow:hidden;opacity:0.7;pointer-events:none;';
    var img = document.createElement('img');
    img.src = champMap[champId].img;
    img.style.cssText = 'width:100%;height:100%;object-fit:cover;';
    touchGhost.appendChild(img);
    document.body.appendChild(touchGhost);
    moveGhost(touch.clientX, touch.clientY);
  }, { passive: true });

  el.addEventListener('touchmove', function(e) {
    if (!touchGhost) return;
    e.preventDefault();
    var touch = e.touches[0];
    moveGhost(touch.clientX, touch.clientY);

    document.querySelectorAll('.hex-cell.drag-over').forEach(function(h) { h.classList.remove('drag-over'); });
    var target = document.elementFromPoint(touch.clientX, touch.clientY);
    if (target) {
      var hex = target.closest('.hex-cell');
      if (hex) hex.classList.add('drag-over');
    }
  }, { passive: false });

  el.addEventListener('touchend', function(e) {
    if (!touchGhost) return;
    document.querySelectorAll('.hex-cell.drag-over').forEach(function(h) { h.classList.remove('drag-over'); });

    var touch = e.changedTouches[0];
    var target = document.elementFromPoint(touch.clientX, touch.clientY);
    if (target) {
      var hex = target.closest('.hex-cell');
      if (hex) {
        var r = parseInt(hex.dataset.row, 10);
        var c = parseInt(hex.dataset.col, 10);
        if (touchDragSource === 'board' && touchDragSrcRow != null) {
          var existing = board[r][c];
          board[r][c] = board[touchDragSrcRow][touchDragSrcCol];
          board[touchDragSrcRow][touchDragSrcCol] = existing;
        } else {
          if (!board[r][c]) board[r][c] = touchDragChampId;
        }
        refreshBoard();
      }
    }

    touchGhost.remove();
    touchGhost = null;
    touchDragChampId = null;
  }, { passive: true });
}

function moveGhost(x, y) {
  if (touchGhost) {
    touchGhost.style.left = (x - 26) + 'px';
    touchGhost.style.top = (y - 26) + 'px';
  }
}

/* ── PARTICLES ── */
(function() {
  var canvas = document.getElementById('particles-canvas');
  var ctx = canvas.getContext('2d');
  var particles = [];

  function resize() {
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
  }

  var COLORS = ['rgba(6,182,212,', 'rgba(139,92,246,', 'rgba(167,139,250,', 'rgba(8,145,178,'];

  function createParticle() {
    return {
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 2 + 0.5,
      vx: (Math.random() - 0.5) * 0.3,
      vy: (Math.random() - 0.5) * 0.3 - 0.1,
      a: Math.random() * 0.5 + 0.1,
      va: (Math.random() - 0.5) * 0.003,
      color: COLORS[Math.floor(Math.random() * COLORS.length)],
      life: 0,
      maxLife: Math.random() * 400 + 200
    };
  }

  function initParticles() {
    resize();
    particles = Array.from({length: 80}, createParticle);
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (var i = 0; i < particles.length; i++) {
      var p = particles[i];
      p.x += p.vx; p.y += p.vy; p.a += p.va; p.life++;
      if (p.a < 0) p.va = Math.abs(p.va);
      if (p.a > 0.6) p.va = -Math.abs(p.va);
      if (p.x < -10) p.x = canvas.width + 10;
      if (p.x > canvas.width + 10) p.x = -10;
      if (p.y < -10) p.y = canvas.height + 10;
      if (p.y > canvas.height + 10) p.y = -10;
      if (p.life > p.maxLife) particles[i] = createParticle();

      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = p.color + p.a + ')';
      ctx.fill();

      if (p.r > 1.3) {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r * 2.5, 0, Math.PI * 2);
        var grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r * 2.5);
        grad.addColorStop(0, p.color + (p.a * 0.25) + ')');
        grad.addColorStop(1, p.color + '0)');
        ctx.fillStyle = grad;
        ctx.fill();
      }
    }

    for (var i = 0; i < particles.length; i++) {
      for (var j = i + 1; j < particles.length; j++) {
        var dx = particles[i].x - particles[j].x;
        var dy = particles[i].y - particles[j].y;
        var dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 90) {
          ctx.beginPath();
          ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y);
          ctx.strokeStyle = 'rgba(6,182,212,' + ((1 - dist / 90) * 0.1) + ')';
          ctx.lineWidth = 0.5;
          ctx.stroke();
        }
      }
    }

    requestAnimationFrame(draw);
  }

  window.addEventListener('resize', resize);
  initParticles();
  draw();
})();

init();
</script>
</body>
</html>
